<template>
  <v-container fluid>
    <v-row>
      <v-col>
        <v-text-field
          label="Code"
          placeholder="Autogenerated"
          persistent-placeholder
          v-model.trim="model.code"
          v-bind="schema('code')"
        >
        </v-text-field>
      </v-col>
    </v-row>
    <v-card title="Identification" class="small-card-title" flat>
      <IdentificationFormFields v-model="model.identification" :mode :errors />
    </v-card>
    <v-card title="Content" class="small-card-title" flat>
      <v-row>
        <v-col cols="12" md="3">
          <ExtBioMatQuantityPicker
            v-model="model.quantity"
            label="Specimen quantity"
            v-bind="schema('quantity')"
          />
        </v-col>
        <v-col cols="12" md="9">
          <v-text-field
            v-model="model.content_description"
            label="Additional details"
            v-bind="schema('content_description')"
          />
        </v-col>
      </v-row>
    </v-card>
    <v-row>
      <v-col>
        <v-card title="References" class="small-card-title" flat>
          <v-text-field
            v-model="model.collection"
            label="Collection"
            v-bind="schema('collection')"
          />
          <v-combobox v-model="model.vouchers" label="Item vouchers" v-bind="schema('vouchers')" />
          <ArticlesPicker
            v-model="model.published_in"
            label="Published in"
            multiple
            clearable
            v-bind="schema('published_in')"
          />
        </v-card>
      </v-col>
    </v-row>
    <v-divider></v-divider>
    <v-row>
      <v-col>
        <v-textarea
          label="Comments"
          v-model.trim="model.comments"
          v-bind="schema('comments')"
        ></v-textarea>
      </v-col>
    </v-row>
  </v-container>
</template>

<script setup lang="ts">
import { $ExternalBioMatInput, $ExternalBioMatUpdate } from '@/api'
import { useSchema } from '@/composables/schema'
import { FormProps } from '@/functions/mutations'
import { BiomatModel } from '@/models'
import { reactiveComputed } from '@vueuse/core'
import ArticlesPicker from '@/components/references/ArticlesPicker.vue'
import ExtBioMatQuantityPicker from '@/components/forms/occurrence/ExtBioMatQuantityPicker.vue'
import IdentificationFormFields from '@/components/forms/occurrence/IdentificationFormFields.vue'

const model = defineModel<BiomatModel.ExternalBiomatModel>({
  default: BiomatModel.initialModel
})

const { mode = 'Create' } = defineProps<FormProps>()

const {
  bind: { schema }
} = reactiveComputed(() =>
  useSchema(mode === 'Create' ? $ExternalBioMatInput : $ExternalBioMatUpdate)
)

// const item = defineModel<BioMaterialWithDetails>()

// const initial: Partial<Omit<ExternalBioMatOccurrenceInput, 'identification'>> & {
//   identification: Partial<IdentificationInput>
// } = {
//   identification: { identified_on: { date: {}, precision: 'Day' } }
// }

// function updateTransformer({
//   sampling,
//   code,
//   comments,
//   identification: { identified_by, identified_on, taxon },
//   is_type,
//   external: { archive, quantity, content_description, original_link, original_taxon },
//   published_in
// }: BioMaterialWithDetails & {
//   category: 'External'
//   external: Exclude<BioMaterialWithDetails['external'], null | undefined>
// }): ExternalBioMatUpdate {
//   return {
//     sampling_id: sampling.id,
//     code,
//     is_type,
//     comments,
//     identification: {
//       identified_by: identified_by.alias,
//       identified_on: DateWithPrecision.toInput(identified_on),
//       taxon: taxon.name
//     },
//     collection: archive.collection,
//     vouchers: archive.vouchers,
//     quantity,
//     content_description,
//     original_link,
//     original_taxon,
//     published_in: published_in?.map(({ code, original }) => ({ code, original })) ?? null
//   }
// }

// const create = defineFormCreate(createExternalBioMatMutation(), {
//   initial,
//   schema: $ExternalBioMatOccurrenceInput,
//   requestData(model) {
//     return {
//       body: model as ExternalBioMatOccurrenceInput
//     }
//   }
// })

// const update = defineFormUpdate(updateExternalBioMatMutation(), {
//   schema: $ExternalBioMatUpdate,
//   itemToModel: updateTransformer,
//   requestData: ({ code }) => ({ path: { code } })
// })
</script>

<style scoped lang="scss"></style>
